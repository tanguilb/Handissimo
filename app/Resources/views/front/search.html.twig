{% extends 'base.html.twig' %}
{% block title %}Handissimo | Voici les résultats de votre recherche.{% endblock %}
{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('css/search.css') }}">
{% endblock %}
{% block body %}
    <section class="container-fluid blue" id="search-reminder">
        <div class="row">
            <div class="container" id="search-done">
                <h3>Votre recherche:</h3>
                <ul>
                    {% if location %}<li>lieu : {{ location }}</li>{% endif %}
                    {% if age %}<li>Pour une personne  : {{ age }} ans</li>{% endif %}
                    {% if need %}<li>Ce que vous cherchez : {{ need }}</li>{% endif %}
                    {% if disability %}<li>Le type de handicap : {{ disability }}</li>{% endif %}
                    {% if structure %}<li>Le type de structure : {{ structure }}</li>{% endif %}
                </ul>
                <a href="{{ path('index_action') }}" >
                    <button class="btn orange-btn">Retour à votre recherche</button>
                </a>

            </div>
        </div>
    </section>


    <section class="container-fluid">
        <div class="row">
            <div class="col-xs-12 col-md-6">
                <div class="row">
                    <div id="map" class="img-responsive"></div>
                </div>
            </div>
            <div class="col-xs-12 col-md-6">
                <div class="row">
                    <div class="col-xs-12 col-md-6">
                        <h4 id="count-results">{{ pagination.getTotalItemCount }} résultat(s)</h4>
                    </div>
                    <div class="col-xs-12 col-md-6">
                            {{ knp_pagination_render(pagination) }}
                    </div>
                </div>
                {% for results in pagination %}

                    <div class="row" id="result-container">
                    <div class="col-sm-5" id="crop-height">
                        {% for pictures in picture %}
                                <a href="{{ path('structure_page', {'id': results['o_id']}) }}">
                                {% if pictures.organizationsId is defined and results['o_id'] == pictures.organizationsId %}
                                    <img src="{{ asset(pictures.webPath) }}" class="img-responsive" alt="Photographie de l'établissement" id="img-search">
                                {% else %}
                                    <img src="{{ asset('images/tim-wright-147360.jpg') }}" class="img-responsive" alt="Photographie par défaut" id="img-search">
                                {% endif %}
                                </a>
                        {% endfor %}

                    </div>
                    <div class="col-sm-7">
                        <div class="col-xs-12">
                            <div class="row">
                                <a href="{{ path('structure_page', {'id': results['o_id']}) }}"><h4 class="searchtitre">{{ results['0.name'] }}</h4></a>
                            </div>
                        </div>
                        <div class="col-xs-12" id="address-container">
                            <p>{{ results['o_address'] }}<br>
                            {{ results['o_postal'] }} {{ results['o_city'] }}</p>
                            <p class="contact-phone">Tél : {{ results['o_phoneNumber'] }}</p>
                        </div>
                        <div class="col-xs-12" id="social-container">
                            {% if results['o_website']  %}
                            <div class="col-xs-7">
                                <div class="row">
                                    <p class="website-address"><a href="{{ results['o_website'] }}" target="_blank">Site internet</a></p>
                                </div>
                            </div>
                            {% endif %}
                            <div class="col-xs-5">
                                {% if results['o_facebook'] %}
                                    <a class="social-media" href="{{ results['o_facebook'] }}" target="_blank"><i class="fa fa-facebook-square" aria-hidden="true"></i></a>
                                {% endif %}
                                {% if results['o_twitter'] %}
                                    <a class="social-media" href="{{ results['o_twitter'] }}" target="_blank"><i class="fa fa-twitter-square" aria-hidden="true"></i></a>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    {% set array = {
                        'name': results[0].name,
                        'address': results[0].address,
                        'postal': results[0].postal,
                        'city': results[0].city,
                        'number': results[0].phoneNumber,
                        'mail': results[0].mail,
                        'web': results[0].website,
                        'latitude': results[0].latitude,
                        'longitude': results[0].longitude,
                        }
                    %}

                    {% set arrayjson = array|json_encode %}
                    <input type="hidden" class="arrayjson" value="{{ arrayjson }}" />
                </div>
                {% else %}
                <div class="container" id="searchnull">
                    <p>Aucun résultat ne correspond à votre recherche. Veuillez réessayer.</p>
                </div>
                {% endfor %}
                <div class="col-xs-12">
                    <div class="row navigation">
                        {{ knp_pagination_render(pagination) }}
                    </div>
                </div>
            </div>
        </div>
    </section>
{% endblock %}
{% block javascripts %}
    <script type="text/javascript" src="{{ asset ('js/googlemap.js')}}"></script>
    <script type="text/javascript" src="{{ asset ('js/advancedSearchCity.js') }}"></script>
    <script async defer
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAT1ybqTsqE0Nzit6xL7PfZWcgnLmThfXc&callback=initMap">
    </script>
{% endblock %}