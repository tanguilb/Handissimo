{% extends 'base.html.twig' %}
{% block title %}Handissimo | Voici les résultats de votre recherche.{% endblock %}
{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('css/search.css') }}">
{% endblock %}
{% block body %}
    <section class="container-fluid blue" id="search-reminder">
        <div class="row">
            <div id="search-done">
                <div class="col-xs-12">
                    <h3>Votre recherche:</h3>
                </div>
                <div class="col-xs-12 col-md-2">
                    {% if location %}<p>Lieu : {{ location }}</p>{% endif %}
                </div>
                <div class="col-xs-12 col-md-2">
                    {% if age %}<p>Pour une personne  : {{ age }} ans</p>{% endif %}
                </div>
                <div class="col-xs-12 col-md-2">
                    {% if need %}<p>Ce que vous cherchez : {{ need }}</p>{% endif %}
                </div>
                <div class="col-xs-12 col-md-2">
                    {% if disability %}
                    <p data-toggle="tooltip" data-placement="bottom" title="{{ disability.disabilityName }}">
                        Le type de handicap : {{ disability.disabilityName|length >15 ? disability.disabilityName|slice(0,15)~'...' : disability.disabilityName }}
                    </p>
                    {% endif %}
                </div>
                <div class="col-xs-12 col-md-2">
                    {% if structure %}
                    <p data-toggle="tooltip" data-placement="bottom" title="{{ structure.name }}">
                        Le type de structure : {{ structure.name|length > 15 ? structure.name|slice(0,15)~'...' : structure.name }}
                    </p>
                    {% endif %}
                </div>
                <div class="col-xs-12 col-md-2">
                    <a href="{{ path('index_action') }}" >
                        <button class="btn orange-btn" id="btn-return">Retour à votre recherche</button>
                    </a>
                </div>
            </div>
        </div>
    </section>


    <section class="container-fluid">
        <div class="row">
            <div class="col-xs-12 col-md-6">
                <div class="row" id="block-map">
                    <div id="map" class="img-responsive"></div>
                </div>
            </div>
            <div class="col-xs-12 col-md-6">
                <div class="row" id="headband-pagination">
                    <div class="col-xs-12 col-sm-12 col-md-3">
                        <h4 id="count-results">{{ pagination.getTotalItemCount }} résultat(s)</h4>
                    </div>
                    <div class="col-xs-12 col-sm-12 col-md-9">
                            {{ knp_pagination_render(pagination) }}
                    </div>
                </div>
                {% for results in pagination %}
                    {#{ dump(pagination) }#}
                    <div class="row" id="result-container">
                        <div class="col-sm-5" id="crop-height">
                            {% for pictures in picture %}
                                    <a href="{{ path('structure_page', {'id': results.id}) }}">
                                    {% if pictures.organizationsId is defined and results.id == pictures.organizationsId %}
                                        {% if loop.first %}
                                            <img src="{{ asset(pictures.webPath) }}" class="img-responsive" alt="Photographie de l'établissement" id="img-search">
                                        {% endif %}
                                    {% else %}
                                        {% if loop.first %}
                                            <img src="{{ asset('images/Etablissement.jpeg') }}" class="img-responsive" alt="Photographie par défaut" id="img-search">
                                        {% endif %}
                                    {% endif %}
                                    </a>
                            {% endfor %}
                        </div>
                        <div class="col-sm-7">
                            <div class="col-xs-12">
                                <div class="row">
                                    <a href="{{ path('structure_page', {'id': results.id}) }}"><h4 class="searchtitre">{{ results.name }}</h4></a>
                                </div>
                            </div>
                            <div class="col-xs-12" id="address-container">
                                <p>{{ results.address }}<br>
                                    {{ results.postal }} {{ results.city }}</p>
                            </div>
                            <div class="col-xs-12" id="social-container">
                                {% if results.website  %}
                                <div class="col-xs-7">
                                    <div class="row">
                                        <p class="website-address"><a href="{{ results.website }}" target="_blank">Site internet</a></p>
                                    </div>
                                </div>
                                {% endif %}
                                <div class="col-xs-5">
                                    {% if results.facebook %}
                                        <a class="social-media" href="{{ results.facebook }}" target="_blank"><i class="fa fa-facebook-square" aria-hidden="true"></i></a>
                                    {% endif %}
                                    {% if results.twitter %}
                                        <a class="social-media" href="{{ results.twitter }}" target="_blank"><i class="fa fa-twitter-square" aria-hidden="true"></i></a>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        {% set array = {
                            'id' : results.id,
                            'name': results.name,
                            'address': results.address,
                            'postal': results.postal,
                            'city': results.city,
                            'number': results.phoneNumber,
                            'mail': results.mail,
                            'web': results.website,
                            'latitude': results.latitude,
                            'longitude': results.longitude,
                            }
                        %}

                        {% set arrayjson = array|json_encode %}
                        <input type="hidden" class="arrayjson" value="{{ arrayjson }}" />
                    </div>
                {% else %}
                <div class="col-xs-12">
                    <div class="row">
                    <p>Il n’y a pas de résultat pour le moment. Vous pouvez essayer d’élargir votre recherche.
                        Dans tous les cas, n’hésitez pas à revenir souvent pour voir les mises à jour.</p>
                    </div>
                </div>
                {% endfor %}
                <div class="col-xs-12">
                    <div class="row navigation">
                        {{ knp_pagination_render(pagination) }}
                    </div>
                </div>
            </div>
        </div>
    </section>
{% endblock %}
{% block javascripts %}
    <script src="{{ asset('bundles/fosjsrouting/js/router.js') }}"></script>
    <script src="{{ path('fos_js_routing_js', { callback: 'fos.Router.setData' }) }}"></script>
    <script type="text/javascript" src="{{ asset ('js/googlemap.js')}}"></script>
    <script type="text/javascript" src="{{ asset ('js/search.js')}}"></script>
    <script async defer
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAT1ybqTsqE0Nzit6xL7PfZWcgnLmThfXc&callback=initMap">
    </script>
{% endblock %}